/*! Map Canvas - v0.1.0 - 2013-09-24
* https://github.com/lukeupup/mapCanvas
* Copyright (c) 2013 Luke; Licensed MIT */
!function(a,b,c){var d=function(a,c,d){var e,f=this,g="",h={fill:d.fillColor,stroke:d.strokeColor,"stroke-width":d.strokeWidth,"stroke-linejoin":d.strokeLinejoin,cursor:d.cursor},i={fill:d.textColor,"font-size":d.fontSize,"font-family":d.fontFamily,cursor:d.cursor},j=d.zoom,k=["mouseover","mouseout","mousemove","click"],l=b(c.canvas).parent();f._option=d,f._forceColored=!1,f._eventHandlers={},f._rawEventHandlers={},f.name=a.name,f.path=null,f.text=null,b.each(a.cmd,function(a,c){var e="";e+=b.map(c.param,function(a){return a*d.zoom}).join(","),e=e.replace(",-","-"),g+=c.method,g+=e}),f.path=c.path(g).attr(h),e=f.path.getBBox(),f.text=c.text(e.x+e.width/2+(a.offset?a.offset.x*j:0),e.y+e.height/2+(a.offset?a.offset.y*j:0),f.name).attr(i),b.each(k,function(a,c){b(f.text.node)[c](function(a){var d=l.offset(),e=b.Event(c,{pageX:a.pageX,pageY:a.pageY});return{x:a.pageX-d.left,y:a.pageY-d.top},b(f.path.node).trigger(e),!1})}),f.on("mouseenter",function(){f._forceColored||(f.path.animate({fill:d.hoverFillColor},100),f.text.animate({fill:d.hoverTextColor},100))}).on("mouseleave",function(){f._forceColored||(f.path.animate({fill:d.fillColor},100),f.text.animate({fill:d.textColor},100))})};d.prototype.on=function(a,c){var d=this,e=function(){c.apply(d,arguments)};return d._eventHandlers[a]?(d._eventHandlers[a].push(e),d._rawEventHandlers[a].push(c)):(d._eventHandlers[a]=[e],d._rawEventHandlers[a]=[c]),b(d.path.node).on(a,e),d},d.prototype.off=function(a,c){var d,e,f=this;if(!f._rawEventHandlers[a])return f;for(e=0;e<f._rawEventHandlers[a].length;e++)if(f._rawEventHandlers[a][e]===c){f._rawEventHandlers[a].splice(e,1),d=f._eventHandlers[a].splice(e,1)[0];break}return d&&b(f.path.node).off(a,d),f},d.data=function(){var a=this,c=b(a.path.node);return c.data.apply(c,arguments)},d.removeData=function(){var a=this,c=b(a.path.node);return c.removeData.apply(c,arguments)},d.prototype.setFillColor=function(a){var b=this;return a?(b.path.animate({fill:a},100),b._forceColored=!0):(b.path.animate({fill:b._option.fillColor},100),b._forceColored=!1),b};var e=function(a,c,e){var f=[];return b.each(a.paths,function(a,b){f.push(new d(b,c,e))}),f},f=function(a,c){var d=b('<div class="J_MapBubble"></div>').appendTo("body").hide().css(c.bubbleStyle);b.each(a,function(a,b){b.on("mouseenter",function(a){d.html(c.bubble(b.name)).css({top:a.pageY+c.bubbleOffset.y,left:a.pageX+c.bubbleOffset.x}).show()}).on("mousemove",function(a){d.css({top:a.pageY+c.bubbleOffset.y,left:a.pageX+c.bubbleOffset.x})}).on("mouseleave",function(){d.hide().empty()})})};b.fn.mapCanvas=function(a,d){var g=b(this);return a?(d=b.extend(!0,{zoom:1,strokeColor:"#AAA",strokeWidth:1,strokeLinejoin:"round",fillColor:"#EEE",textColor:"#555",hoverFillColor:"#FAA",hoverTextColor:"#555",fontSize:"12px",fontFamily:"arial, sans-serif",cursor:"pointer",bubble:function(a){return a.name},bubbleOffset:{x:10,y:10},bubbleStyle:{background:"#333",color:"#FFF",borderRadius:"3px",padding:"5px 10px"},onMapInit:b.noop,onAreaClick:b.noop,onAreaMouseenter:b.noop,onAreaMouseleave:b.noop,onAreaMousemove:b.noop},d),d.width?(d.zoom=d.width/a.dimension.width,d.height=a.dimension.height*d.zoom):(d.width=d.zoom*a.dimension.width,d.height=d.zoom*a.dimension.height),b.extend(d.bubbleStyle,{position:"absolute",zIndex:"2000",wordWrap:"break-word",fontFamily:d.fontFamily,fontSize:d.fontSize}),g.each(function(g,h){var i=(b(h).width(d.width).height(d.height).empty(),c(h,d.width,d.height)),j=e(a,i,d);d.bubble&&f(j,d),b.each(j,function(a,b){b.on("click",d.onAreaClick),b.on("mouseenter",d.onAreaMouseenter),b.on("mouseleave",d.onAreaMouseleave),b.on("mousemove",d.onAreaMousemove)}),d.onMapInit&&d.onMapInit()}),this):this}}(window,jQuery,Raphael);