/*! Map Canvas - v0.1.0 - 2013-09-26
* https://github.com/lukeupup/mapCanvas
* Copyright (c) 2013 Luke; Licensed MIT */
!function(a,b,c,d){var e=function(a,c,d){var e,f=this,g="",h={fill:d.fillColor,stroke:d.strokeColor,"stroke-width":d.strokeWidth,"stroke-linejoin":d.strokeLinejoin,cursor:d.cursor},i={fill:d.textColor,"font-size":d.fontSize,"font-family":d.fontFamily,cursor:d.cursor},j=d.zoom,k=["mouseover","mouseout","mousemove","click"],l=b(c.canvas).parent();f._option=d,f._forceColor="",f._forceHoverColor="",f._eventHandlers={},f._rawEventHandlers={},f._bubble=d.bubble,f._$bubble=d.$bubble,f.name=a.name,f.path=null,f.text=null,b.each(a.cmd,function(a,c){var e="";e+=b.map(c.param,function(a){return a*d.zoom}).join(","),e=e.replace(",-","-"),g+=c.method,g+=e}),f.path=c.path(g).attr(h),d.showText&&(e=f.path.getBBox(),f.text=c.text(e.x+e.width/2+(a.offset?a.offset.x*j:0),e.y+e.height/2+(a.offset?a.offset.y*j:0),f.name).attr(i),b.each(k,function(a,c){b(f.text.node)[c](function(a){var d=l.offset(),e=b.Event(c,{pageX:a.pageX,pageY:a.pageY});return{x:a.pageX-d.left,y:a.pageY-d.top},b(f.path.node).trigger(e),!1})})),f.on("mouseenter",function(a){f._bubble&&f._$bubble.html(f._bubble(f)).css({top:a.pageY+d.bubbleOffset.y,left:a.pageX+d.bubbleOffset.x}).show(),f._forceHoverColor?(f.path.animate({fill:f._forceHoverColor},100),f.text&&f.text.animate({fill:d.hoverTextColor},100)):(f.path.animate({fill:d.hoverFillColor},100),f.text&&f.text.animate({fill:d.hoverTextColor},100))}).on("mouseleave",function(){f._bubble&&f._$bubble.hide().empty(),f._forceColor?(f.path.animate({fill:f._forceColor},100),f.text&&f.text.animate({fill:d.textColor},100)):(f.path.animate({fill:d.fillColor},100),f.text&&f.text.animate({fill:d.textColor},100))}).on("mousemove",function(a){f._bubble&&f._$bubble.css({top:a.pageY+f._option.bubbleOffset.y,left:a.pageX+f._option.bubbleOffset.x})})};e.prototype.on=function(a,c){var d=this,e=function(){c.apply(d,arguments)};return d._eventHandlers[a]?(d._eventHandlers[a].push(e),d._rawEventHandlers[a].push(c)):(d._eventHandlers[a]=[e],d._rawEventHandlers[a]=[c]),b(d.path.node).on(a,e),d},e.prototype.off=function(a,c){var d,e,f=this;if(!f._rawEventHandlers[a])return f;for(e=0;e<f._rawEventHandlers[a].length;e++)if(f._rawEventHandlers[a][e]===c){f._rawEventHandlers[a].splice(e,1),d=f._eventHandlers[a].splice(e,1)[0];break}return d&&b(f.path.node).off(a,d),f},e.prototype.data=function(){var a=this,c=b(a.path.node);return c.data.apply(c,arguments)},e.prototype.removeData=function(){var a=this,c=b(a.path.node);return c.removeData.apply(c,arguments)},e.prototype.setFillColor=function(a,b){var c=this;return a?(c.path.animate({fill:a},100),c._forceColor=a,c._forceHoverColor=b||a):(c.path.animate({fill:c._option.fillColor},100),c._forceColor="",c._forceHoverColor=""),c},e.prototype.setBubble=function(a){var b=this;b._bubble=a};var f=function(a,c,d){var f=[];return b.each(a.paths,function(a,b){f.push(new e(b,c,d))}),f};b.fn.mapCanvas=function(a,e){var g=b(this);if(!a)return this;if("areas"===a)return b(this).data("mapCanvas.areas");if("object"!=typeof a)throw'The first argument should be an object, or exactly "areas".';return e=b.extend(!0,{width:d,height:d,zoom:1,showText:!0,strokeColor:"#AAA",strokeWidth:1,strokeLinejoin:"round",fillColor:"#EEE",textColor:"#555",hoverFillColor:"#FAA",hoverTextColor:"#555",fontSize:"12px",fontFamily:"arial, sans-serif",cursor:"pointer",bubbleClass:"J_MapBubble",bubble:function(a){return a.name},bubbleOffset:{x:10,y:10},bubbleStyle:{background:"#333",color:"#FFF",borderRadius:"3px",padding:"5px 10px"},onMapInit:b.noop,onAreaClick:b.noop,onAreaMouseenter:b.noop,onAreaMouseleave:b.noop,onAreaMousemove:b.noop},e),e.width?(e.zoom=e.width/a.dimension.width,e.height=a.dimension.height*e.zoom):e.height?(e.zoom=e.height/a.dimension.height,e.width=a.dimension.width*e.zoom):(e.width=e.zoom*a.dimension.width,e.height=e.zoom*a.dimension.height),b.extend(e.bubbleStyle,{position:"absolute",zIndex:"2000",wordWrap:"break-word",fontFamily:e.fontFamily,fontSize:e.fontSize}),g.each(function(d,g){var h,i=b(g).width(e.width).height(e.height).empty(),j=c(g,e.width,e.height);e.$bubble=b("<div></div>").attr("class",e.bubbleClass).appendTo("body").hide().css(e.bubbleStyle),h=f(a,j,e),b.each(h,function(a,b){b.on("click",e.onAreaClick),b.on("mouseenter",e.onAreaMouseenter),b.on("mouseleave",e.onAreaMouseleave),b.on("mousemove",e.onAreaMousemove)}),i.data("mapCanvas.areas",h),e.onMapInit&&e.onMapInit()}),this}}(window,jQuery,Raphael);